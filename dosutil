#!/bin/bash
# Script Name: dosutil
# Purpose: Emulate basic DOS/Windows file management commands in Linux/UNIX
# Author: Evan Singer
# Last Revision Date: 11/8/2023
# Variables:
#    ARG1 = Command
#    ARG2 = Filename
#    ARG3 = Destination Directory
COMMAND=$1
SOURCEDIR=$2
DESTDIR=$3
shift

# Define function for displaying the help message
help() {
    echo "Usage: dosutil <command> [parameters]"
    echo "Supported Commands:"
    echo "  author - Output your name in the form last, first"
    echo "  type   - Output the content of the file in the first parameter"
    echo "  copy   - Copy a file or directory"
    echo "  ren    - Rename a file or directory"
    echo "  move   - Move a file or directory"
    echo "  del    - Delete a file or directory (without asking for confirmation)"
    echo "  help   - Output this help message"
}

# Function to execute UNIX file manipulation commands
execute_command() {
    echo ""
    echo "UNIX command ran: $*"
    echo ""
    if "$@"; then
        echo "Command executed successfully."
    else
        echo "Command execution failed."
        exit 1
    fi
}

# Function to verify file or directory existence
verify_file() {
    if [ -e "$1" ]; then
        if [ -f "$1" ]; then
            echo "File exists: $1"
        elif [ -d "$1" ]; then
            echo "Directory exists: $1"
        fi
    else
        echo "Error: File or directory not found: $1"
        exit 1
    fi
}

# Processes the command with a case statement
case "$COMMAND" in
    author)
        if [ $# -gt 0 ]; then
            echo "Error: There are too many arguments for the 'author' command."
            help
            exit 1
        fi
        echo "Singer, Evan"
        ;;

    type)
        if [ $# -eq 0 ]; then
            echo "Error: The filename is missing for the 'type' command."
            help
            exit 1
        fi
        verify_file "$SOURCEDIR"
        if [ $# -gt 1 ]; then
            echo "Error: There are too many arguments for the 'type' command."
            help
            exit 1
        fi
        cat "$SOURCEDIR"
        ;;

    copy)
        if [ $# -lt 2 ]; then
            echo "Error: There is a missing source or destination filename for the 'copy' command."
            help
            exit 1
        fi
        verify_file "$SOURCEDIR"
        verify_file "$DESTDIR"
        if [ -e "$DESTDIR" ]; then
            echo "Error: Destination file or directory already exists. Use -o to overwrite."
            exit 1
        fi
        if [ $# -gt 2 ]; then
            if [ "$4" == "-o" ]; then
                execute_command cp -r "$SOURCEDIR" "$DESTDIR"
            else
                echo "Error: There are too many arguments for the 'copy' command."
                help
                exit 1
            fi
        else
            execute_command cp -r "$SOURCEDIR" "$DESTDIR"
        fi
        ;;

    ren)
        if [ $# -lt 2 ]; then
            echo "Error: There is a missing source or destination filename for the 'ren' command."
            help
            exit 1
        fi
        verify_file "$SOURCEDIR"
        verify_file "$DESTDIR"
        if [ -e "$DESTDIR" ]; then
            echo "Error: Destination file or directory already exists. Use -o to overwrite."
            exit 1
        fi
        if [ $# -gt 2 ]; then
            if [ "$4" == "-o" ]; then
                execute_command mv "$SOURCEDIR" "$DESTDIR"
            else
                echo "Error: There are too many arguments for the 'ren' command."
                help
                exit 1
            fi
        else
            execute_command mv "$SOURCEDIR" "$DESTDIR"
        fi
        ;;

    move)
        if [ $# -lt 2 ]; then
            echo "Error: There is a missing source or destination filename for the 'move' command."
            help
            exit 1
        fi
        verify_file "$SOURCEDIR"
        verify_file "$DESTDIR"
        if [ -e "$DESTDIR" ]; then
            echo "Error: Destination file or directory already exists. Use -o to overwrite."
            exit 1
        fi
        if [ $# -gt 2 ]; then
            if [ "$4" == "-o" ]; then
                execute_command mv "$SOURCEDIR" "$DESTDIR"
            else
                echo "Error: There are too many arguments for the 'move' command."
                help
                exit 1
            fi
        else
            execute_command mv "$SOURCEDIR" "$DESTDIR"
        fi
        ;;

    del)
        if [ $# -eq 0 ]; then
            echo "Error: The filename for 'del' command is missing."
            help
            exit 1
        fi
        verify_file "$SOURCEDIR"
        if [ $# -gt 1 ]; then
            echo "Error: There are too many arguments for 'del' command."
            help
            exit 1
        fi
        execute_command rm -rf "$SOURCEDIR"
        ;;

    help)
        if [ $# -gt 0 ]; then
            echo "Error: There are too many arguments for 'help' command."
            help
            exit 1
        fi
        help
        ;;

    *)
        if [ -z "$COMMAND" ]; then
            echo "Error: You have not provided a command."
            help
            exit 1
        else
            echo "Error: Invalid command '$COMMAND'"
            help
            exit 1
        ;;
esac

exit 0
