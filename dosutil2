#!/bin/bash

# Function to verify a file's existence and type
verify_file_or_directory() {
  if [ $# -lt 1 ]; then
    echo "Usage: verify_file_or_directory [filename or directory]"
    exit 1
  }
  target="$1"
  if [ -e "$target" ]; then
    if [ -f "$target" ]; then
      echo "File '$target' exists and is a regular file."
    elif [ -d "$target" ]; then
      echo "Directory '$target' exists."
    else
      echo "The target '$target' exists but is of an unknown type."
      exit 1
    fi
  else {
    echo "The target '$target' does not exist."
    exit 1
  }
}

# Function to execute UNIX commands for file manipulation and verify success
execute_file_commands() {
  if [ $# -lt 2 ]; then
    echo "Usage: execute_file_commands [source] [destination]"
    exit 1
  }
  source="$1"
  destination="$2"
  verify_file_or_directory "$source"
  verify_file_or_directory "$destination"
  if [ -e "$destination" ]; then
    if [ "$command" = "copy!" ] || [ "$command" = "ren!" ] || [ "$command" = "move!" ]; then
      echo "Destination '$destination' already exists. Overwriting..."
    else
      echo "Error: Destination '$destination' already exists. Overwriting is not allowed."
      exit 1
    fi
  fi

  unix_command=""
  success_message="Command completed successfully."
  error_message="Error: Command failed."

  if [ "$command" = "copy" ] || [ "$command" = "copy!" ]; then
    unix_command="cp -r \"$source\" \"$destination\""
  elif [ "$command" = "ren" ] || [ "$command" = "ren!" ]; then
    unix_command="mv \"$source\" \"$destination\""
  elif [ "$command" = "move" ] || [ "$command" = "move!" ]; then
    unix_command="mv \"$source\" \"$destination\""
  elif [ "$command" = "del" ]; then
    unix_command="rm -r \"$source\""
    success_message="File/directory deleted successfully."
    error_message="Error: Deletion failed."
  fi

  echo "UNIX command ran: $unix_command"
  echo

  eval "$unix_command"
  status=$?

  if [ $status -eq 0 ]; then
    echo "$success_message"
  else
    echo "$error_message"
    exit 1
  fi
}

# Function to output the content of a file
type_file() {
  if [ $# -lt 1 ]; then
    echo "Usage: $0 type [filename]"
    exit 1
  }
  filename="$1"
  cat "$filename"
}

# Function to output a help message
help_message() {
  echo "Supported commands:"
  echo "author - output your name in the form last, first"
  echo "type [filename] - output the content of the file"
  echo "copy [source] [destination] - copy a file or directory"
  echo "ren [oldname] [newname] - rename a file or directory"
  echo "move [source] [destination] - move a file or directory"
  echo "del [filename or directory] - delete a file or directory without confirmation"
  echo "copy! [source] [destination] - copy a file or directory with overwriting"
  echo "ren! [oldname] [newname] - rename a file or directory with overwriting"
  echo "move! [source] [destination] - move a file or directory with overwriting"
  echo "help - output this help message"
}

# Main script logic
if [ $# -lt 1 ]; then
  echo "Usage: $0 [command] [additional arguments]"
  exit 1
fi

# Extract the command from the first parameter
command="$1"
shift # Remove the command from the argument list

case "$command" in
  "copy" | "ren" | "move" | "del" | "copy!" | "ren!" | "move!")
    verify_file_or_directory "$1"
    verify_file_or_directory "$2"
    execute_file_commands "$@"
    ;;
  "author")
    echo "Your Name: Last, First"
    ;;
  "type")
    type_file "$@"
    ;;
  "help")
    help_message
    ;;
  *)
    echo "Invalid command: $command"
    help_message
    exit 1
    ;;
esac
